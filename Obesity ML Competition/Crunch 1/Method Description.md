# Method Description

**Author: Francesco Orsi**

Our approach predicts unseen single-gene perturbation effects using a multi-strategy ensemble combining dual gene embedding spaces, three complementary linear predictors with true leave-one-out cross-validated blending, adaptive shrinkage regularization, and per-program low-rank covariance modeling for distributional accuracy. We construct two complementary gene embeddings: a response embedding (PCA on the gene-by-perturbation delta matrix, capturing how each gene's expression changes across all training perturbations) and a coexpression embedding (PCA on the cell-by-gene matrix, capturing which genes are transcriptionally co-regulated across individual cells). For each perturbation target, these dual embeddings are augmented with eight expression statistics including control mean, variance, control-perturbed delta, response variability, and max perturbation response, forming a 98-dimensional feature vector. Three prediction strategies are deployed in ensemble: a primary RidgeCV, a strongly regularized Ridge acting as a shrinkage fallback, and distance-weighted K-nearest-neighbor interpolation in the dual embedding space. Ensemble weights are optimized via true leave-one-out cross-validation using hat-matrix LOO predictions for Ridge components, maximizing Pearson correlation of predicted deltas on highly variable genes. A post-ensemble shrinkage factor is optimized to regularize predictions toward the perturbed mean baseline, preventing overconfident extrapolation for distant perturbation targets. For cell distribution generation, we employ a mixture-of-programs model where 100 cells are allocated proportionally to pre-adipocyte, adipocyte, lipogenic, and other states via multinomial sampling, with perturbation-adaptive noise scaling derived from KNN neighbors' observed variance. Noise is generated using separate low-rank covariance structures estimated per program from training cells, preserving program-specific gene-gene correlation patterns, and a softplus activation replaces hard zero-clamping to avoid distributional artifacts at the zero boundary. Program proportions are predicted by per-program Ridge models with true LOO optimization, augmented with per-program signature gene cosine similarity features, with Ridge-KNN blend weights tuned via the competition's exact weighted L1 metric including all four cell state proportions.

# Rationale

Three key insights from the perturbation prediction literature motivate our design. First, Ahlmann-Eltze et al. (Nature Methods, 2025) demonstrated that deep learning models including GEARS, scGPT, and scFoundation do not outperform simple linear baselines on perturbation prediction tasks, validating our investment in feature engineering over model complexity. Second, single-cell data is inherently multimodal: perturbations shift cell populations between distinct states rather than uniformly displacing all cells, making our mixture-of-programs model biologically grounded and essential for MMD accuracy. Third, gene-gene correlations organized into co-expression modules are a fundamental property of transcriptomic data, and independent Gaussian noise destroys this structure entirely. Our per-program low-rank covariance estimation preserves these correlations while remaining computationally efficient on a single CPU. The dual embedding strategy addresses a specific failure mode of single-embedding approaches: response embeddings capture perturbation sensitivity but are limited to genes present in the training matrix, while coexpression embeddings are defined for all genes and capture baseline regulatory relationships. Their combination provides robust features for generalization to the 2,863 unseen perturbation targets. True leave-one-out cross-validation via closed-form hat-matrix computation for Ridge eliminates the in-sample optimism bias that corrupts ensemble weight selection when using fitted predictions, and the additional shrinkage layer provides a principled guard against overprediction on out-of-distribution perturbations. Perturbation-adaptive noise scaling using KNN neighbors' observed variance ensures that predicted cell distributions match the heterogeneity expected for each perturbation target rather than applying a uniform noise level.

# Data and Resources Used

We exclusively use the provided competition dataset (obesity_challenge_1.h5ad) containing CRISPR/Cas9 single-gene perturbation screens targeting 157 genes (150 transcription factors) with single-cell RNA-seq profiles at day 14 of adipocyte differentiation. Expression data uses the provided log2(1+x) normalization stored in adata.X. Cell program enrichment annotations (pre_adipo, adipo, lipo, other) from adata.obs define four cell states used in our mixture model and per-program covariance estimation. The signature_genes.csv file provides expert-curated canonical marker genes used to construct per-program cosine similarity features linking each perturbation target to the transcriptional programs defining adipocyte differentiation states. Per-program mean expression profiles and stratified cell pools computed from training data serve as baselines for program-specific cell generation and separate low-rank covariance estimation. The highly variable gene set identified from training data variance is used to align LOO ensemble optimization with the competition's evaluation focus. No external datasets, pre-trained models, Gene Ontology databases, or gene regulatory networks are used, ensuring full reproducibility within CrunchDAO platform constraints. Our implementation relies solely on numpy, scipy, scikit-learn, pandas, and anndata.
